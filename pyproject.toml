[project]
name = "south-east-archers"
version = "1.0.0"
description = "South East Archers Club Website"
requires-python = ">=3.14"
dependencies = [
    "Flask==3.1.2",
    "flask-vite-assets>=0.1.0",
    "Flask-SQLAlchemy==3.1.1",
    "Flask-Migrate==4.1.0",
    "Flask-Mail==0.10.0",
    "SQLAlchemy>=2.0.30",
    "cryptography>=41.0.0",
    "email-validator==2.3.0",
    "Werkzeug==3.1.5",
    "python-dotenv==1.2.1",
    "requests==2.32.5",
    "MarkupSafe==3.0.3",
    "PyMySQL==1.1.2",
    "itsdangerous==2.2.0",
    "Flask-Login==0.6.3",
    "Flask-Bcrypt==1.0.1",
    "Flask-WTF==1.2.2",
    "WTForms==3.2.1",
    "gunicorn==24.1.0",
    "whitenoise==6.11.0",
    "sumup==0.0.13",
]

[dependency-groups]
dev = [
    "flask-shell-ipython",
    "watchdog[watchmedo]",
    "pytest==9.0.2",
    "pytest-cov==7.0.0",
    "pytest-flask==1.3.0",
    "pytest-sugar>=1.1.1",
    "mypy>=1.19.1",
    "pytest-mock>=3.15.1",
    "ruff>=0.14.14",
    "import-linter>=2.10",
]

[tool.coverage.run]
omit = [
    "*/tests/*",
    "*/conftest.py",
    "*/.venv/*",
    "*/venv/*",
    "app/schedule.py",  # Schedule configuration file - no logic to test
]

[tool.coverage.report]
show_missing = true
skip_empty = true

[tool.ruff]
line-length = 160
target-version = "py314"

[tool.ruff.lint]
# Enable pycodestyle (E), Pyflakes (F), unused imports (F401), unused variables (F841), isort (I)
select = ["E", "F", "I", "W", "UP"]
ignore = [
    "E501",  # Line too long (handled by formatter)
    "E741",  # Ambiguous variable name
]

[tool.ruff.lint.per-file-ignores]
"__init__.py" = ["F401"]  # Allow unused imports in __init__.py files

[tool.ruff.format]
quote-style = "double"
indent-style = "space"

# ---------------------------------------------------------------------------
# import-linter â€“ enforces module boundaries
# ---------------------------------------------------------------------------

[tool.importlinter]
root_packages = ["app"]
include_external_packages = false

[[tool.importlinter.contracts]]
name = "Routes must not import db directly"
type = "forbidden"
source_modules = [
    "app.routes.auth",
    "app.routes.member",
    "app.routes.payment",
    "app.routes.public",
    "app.routes.admin.dashboard",
    "app.routes.admin.events",
    "app.routes.admin.members",
    "app.routes.admin.news",
    "app.routes.admin.payments",
    "app.routes.admin.roles",
    "app.routes.admin.settings",
    "app.routes.admin.shoots",
]
forbidden_modules = ["app.db"]

[[tool.importlinter.contracts]]
name = "Services must not import db directly"
type = "forbidden"
source_modules = [
    "app.services.admin_service",
    "app.services.event_service",
    "app.services.membership_service",
    "app.services.news_service",
    "app.services.payment_processing_service",
    "app.services.payment_service",
    "app.services.rbac_service",
    "app.services.settings_service",
    "app.services.shoot_service",
    "app.services.user_service",
]
forbidden_modules = ["app.db"]


